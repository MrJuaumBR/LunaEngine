<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Particle Demo - LunaEngine Examples</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="../theme.css" rel="stylesheet">
</head>
<body>
    
    <nav class="navbar navbar-expand-lg navbar-light sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="../index.html" id="navbar-logo-link">
                <i class="bi bi-moon-stars-fill me-2"></i>
                LunaEngine
            </a>
            <div class="d-flex align-items-center">
                <div class="input-group me-3">
                    <input type="text" id="moduleSearch" class="form-control" placeholder="Search functions, classes, methods...">
                    <span class="input-group-text" id="searchIcon"><i class="bi bi-search"></i></span>
                </div>
                
                <button class="btn btn-outline-secondary theme-toggle">
                    <span class="theme-icon">ðŸŒ™</span>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container mt-5">
        <nav aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../index.html">Home</a></li><li class="breadcrumb-item"><a href="index.html">Examples Hub</a></li><li class="breadcrumb-item active">Particle Demo</li></ol></nav>
        
        <div class="row">
            <div class="col-lg-8">
                <h1 class="mb-3"><i class="bi bi-code-slash me-2"></i>Particle Demo</h1>
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-file-earmark-code me-2"></i>particle_demo.py</h5>
                    </div>
                    <div class="card-body">
                        <pre><code class="language-python">&quot;&quot;&quot;
Particle System Demo - Fixed Version
&quot;&quot;&quot;

import sys
import os
sys.path.append(os.path.join(os.path.dirname(__file__), &#x27;..&#x27;))

import pygame
from lunaengine.core import LunaEngine, Scene
from lunaengine.ui.elements import *
from lunaengine.graphics.particles import *
from lunaengine.graphics.camera import Camera, CameraMode

class ParticleDemoScene(Scene):
    &quot;&quot;&quot;Interactive particle system demo scene&quot;&quot;&quot;
    
    def on_exit(self, next_scene = None):
        return super().on_exit(next_scene)
    
    def on_enter(self, previous_scene: str = None):
        return super().on_enter(previous_scene)
    
    def __init__(self, engine: LunaEngine):
        super().__init__(engine)
        self.demo_state = {
            &#x27;active_particles&#x27;: 0,
            &#x27;fps&#x27;: 0,
            &#x27;memory_usage&#x27;: 0,
            &#x27;emission_rate&#x27;: 50,
            &#x27;selected_particle&#x27;: &quot;dust&quot;,  # Uses string
            &#x27;selected_exit&#x27;: &quot;top&quot;,
            &#x27;selected_physics&#x27;: &quot;topdown&quot;, 
            &#x27;spread&#x27;: 45.0,
            &#x27;auto_emit&#x27;: True,
            &#x27;show_metrics&#x27;: True,
        }
        self.emitter_positions = [
            (-200, -200), (-200, 200), (0, 50), (200, -200), (200, 200)
        ]
        self.setup_ui()
        
        # Register some custom particles
        self.setup_custom_particles()
        
        self.particle_system.get_physics_names()
        
    def setup_custom_particles(self):
        &quot;&quot;&quot;Setup custom particle types for testing&quot;&quot;&quot;
        # Magic particles
        magic_config = ParticleConfig(
            color_start=(200, 0, 255),
            color_end=(100, 0, 200),
            size_start=6.0,
            size_end=10.0,
            lifetime=2.0,
            speed=120.0,
            gravity=-80.0,
            spread=90.0,
            fade_out=True,
            grow=True
        )
        self.particle_system.register_custom_particle(&quot;magic&quot;, magic_config)
        
        # Electric sparks
        electric_config = ParticleConfig(
            color_start=(0, 200, 255),
            color_end=(0, 100, 255),
            size_start=3.0,
            size_end=1.0,
            lifetime=0.8,
            speed=250.0,
            gravity=50.0,
            spread=15.0,
            fade_out=True
        )
        self.particle_system.register_custom_particle(&quot;electric&quot;, electric_config)

    def setup_ui(self):
        &quot;&quot;&quot;Setup all UI controls and displays&quot;&quot;&quot;
        self.camera.mode = CameraMode.FIXED
        print(self.camera.viewport_width, self.camera.viewport_height)
        
        print(self.camera.world_to_screen((0,0)))
        print(self.camera.screen_to_world((0,0)))
        
        # Title
        title = TextLabel(512, 20, &quot;LunaEngine - Particle System Demo&quot;, 32, root_point=(0.5, 0))
        self.add_ui_element(title)
        
        # FPS and Performance Display
        self.fps_display = TextLabel(20, 20, &quot;FPS: --&quot;, 18, (100, 255, 100))
        self.add_ui_element(self.fps_display)
        
        self.particle_count_display = TextLabel(20, 45, &quot;Particles: 0&quot;, 16, (200, 200, 255))
        self.add_ui_element(self.particle_count_display)
        
        self.memory_display = TextLabel(20, 70, &quot;Memory: 0.0 MB&quot;, 16, (255, 200, 100))
        self.add_ui_element(self.memory_display)
        
        # Section 1: Particle Type Selection
        section1_title = TextLabel(20, 110, &quot;Particle Type&quot;, 20, (255, 255, 0))
        self.add_ui_element(section1_title)
        
        # Particle type selector
        self.particle_dropdown = Dropdown(20, 140, 150, 30, self.particle_system.get_particles_names(True,True))
        self.particle_dropdown.set_on_selection_changed(
            lambda i, v: self.update_state(&#x27;selected_particle&#x27;, v)
        )
        self.add_ui_element(self.particle_dropdown)
        
        # Section 2: Emission Controls
        section2_title = TextLabel(20, 190, &quot;Emission Controls&quot;, 20, (255, 255, 0))
        self.add_ui_element(section2_title)
        
        # Emission rate slider
        emission_label = TextLabel(20, 220, &quot;Emission Rate:&quot;, 16)
        self.add_ui_element(emission_label)
        
        self.emission_slider = Slider(20, 240, 150, 20, 1, 500, 50)
        self.emission_slider.on_value_changed = lambda v: self.update_state(&#x27;emission_rate&#x27;, int(v))
        self.add_ui_element(self.emission_slider)
        
        self.emission_display = TextLabel(180, 240, &quot;50 p/s&quot;, 14)
        self.add_ui_element(self.emission_display)
        
        # Spread control
        spread_label = TextLabel(20, 270, &quot;Spread Angle:&quot;, 16)
        self.add_ui_element(spread_label)
        
        self.spread_slider = Slider(20, 290, 150, 20, 0, 360, 45)
        self.spread_slider.on_value_changed = lambda v: self.update_state(&#x27;spread&#x27;, v)
        self.add_ui_element(self.spread_slider)
        
        self.spread_display = TextLabel(180, 290, &quot;45Â°&quot;, 14)
        self.add_ui_element(self.spread_display)
        
        # Section 3: Physics and Exit Points
        section3_title = TextLabel(20, 330, &quot;Physics &amp; Emission&quot;, 20, (255, 255, 0))
        self.add_ui_element(section3_title)
        
        exit_points = [&quot;top&quot;, &quot;bottom&quot;, &quot;left&quot;, &quot;right&quot;, &quot;center&quot;, &quot;circular&quot;]
        self.exit_dropdown = Dropdown(20, 360, 150, 30, exit_points)
        self.exit_dropdown.set_on_selection_changed(
            lambda i, v: self.update_state(&#x27;selected_exit&#x27;, v)
        )
        self.add_ui_element(self.exit_dropdown)
        
        # Physics type selector
        self.physics_dropdown = Dropdown(20, 400, 150, 30, self.particle_system.get_physics_names(True, True))
        self.physics_dropdown.set_on_selection_changed(
            lambda i, v: self.update_state(&#x27;selected_physics&#x27;, v)
        )
        self.add_ui_element(self.physics_dropdown)
        
        # Section 4: Controls
        section4_title = TextLabel(20, 450, &quot;Controls&quot;, 20, (255, 255, 0))
        self.add_ui_element(section4_title)
        
        # Auto emission toggle
        self.auto_emit_switch = Switch(20, 480, 60, 30, True)
        self.auto_emit_switch.set_on_toggle(lambda s: self.update_state(&#x27;auto_emit&#x27;, s))
        self.add_ui_element(self.auto_emit_switch)
        
        auto_emit_label = TextLabel(90, 485, &quot;Auto Emission&quot;, 16)
        self.add_ui_element(auto_emit_label)
        
        # Burst mode button
        burst_button = Button(20, 520, 120, 30, &quot;Burst Emission&quot;)
        burst_button.set_on_click(lambda: self.emit_burst())
        self.add_ui_element(burst_button)
        
        # Clear particles button
        clear_button = Button(150, 520, 120, 30, &quot;Clear All&quot;)
        clear_button.set_on_click(lambda: self.particle_system.clear())
        self.add_ui_element(clear_button)
        
        # Manual emit button
        manual_button = Button(20, 560, 250, 30, &quot;Click Here to Emit Manually&quot;)
        manual_button.set_on_click(lambda: self.emit_manual())
        self.add_ui_element(manual_button)

    def update_state(self, key, value):
        &quot;&quot;&quot;Update demo state and refresh displays&quot;&quot;&quot;
        if key in [&#x27;particle_type&#x27;, &#x27;physics_type&#x27;]: value = str(value).lower()
        self.demo_state[key] = value
        print(f&quot;Updated {key} to {value}&quot;)  # DEBUG
        
        # Update UI displays
        self.emission_display.set_text(f&quot;{self.demo_state[&#x27;emission_rate&#x27;]} p/s&quot;)
        self.spread_display.set_text(f&quot;{self.demo_state[&#x27;spread&#x27;]:.0f}Â°&quot;)

    def emit_manual(self):
        &quot;&quot;&quot;Emit particles manually from center&quot;&quot;&quot;
        particle_type = ParticleType[self.demo_state[&#x27;selected_particle&#x27;].upper()]
        exit_point = ExitPoint[self.demo_state[&#x27;selected_exit&#x27;].upper()]
        physics_type = PhysicsType[self.demo_state[&#x27;selected_physics&#x27;].upper()]
        
        # Emit at world center (0,0)
        px,py = 0, 0
        print(self.camera.world_to_screen((px, py)))
        
        self.particle_system.emit(
            x=px, y=py,
            particle_type=particle_type,
            count=100,
            exit_point=exit_point,
            physics_type=physics_type,
            spread=self.demo_state[&#x27;spread&#x27;]
        )
        print(f&quot;Emitted 100 {self.demo_state[&#x27;selected_particle&#x27;]} particles&quot;)

    def emit_burst(self):
        &quot;&quot;&quot;Emit a burst of particles from all emitter positions&quot;&quot;&quot;
        particle_type = ParticleType[self.demo_state[&#x27;selected_particle&#x27;].upper()]
        exit_point = ExitPoint[self.demo_state[&#x27;selected_exit&#x27;].upper()]
        physics_type = PhysicsType[self.demo_state[&#x27;selected_physics&#x27;].upper()]
        
        for x, y in self.emitter_positions:
            self.particle_system.emit(
                x=x, y=y,
                particle_type=particle_type,
                count=50,
                exit_point=exit_point,
                physics_type=physics_type,
                spread=self.demo_state[&#x27;spread&#x27;]
            )
        print(f&quot;Emitted burst of {self.demo_state[&#x27;selected_particle&#x27;]} particles&quot;)

    def on_enter(self, previous_scene: str = None):
        &quot;&quot;&quot;Called when scene becomes active&quot;&quot;&quot;
        print(&quot;=== Particle System Demo ===&quot;)
        print(&quot;Controls:&quot;)
        print(&quot;- Use dropdowns to select particle type, exit point, and physics&quot;)
        print(&quot;- Adjust sliders for emission rate and spread&quot;)
        print(&quot;- Click buttons to emit particles&quot;)
        print(&quot;- Toggle auto-emission on/off&quot;)

    def update(self, dt):
        &quot;&quot;&quot;Update scene logic&quot;&quot;&quot;
        # Update particle system
        self.particle_system.update(dt)
        
        # Auto emission from fixed positions
        if self.demo_state[&#x27;auto_emit&#x27;]:
            particle_type = ParticleType[self.demo_state[&#x27;selected_particle&#x27;].upper()]
            exit_point = ExitPoint[self.demo_state[&#x27;selected_exit&#x27;].upper()]
            physics_type = PhysicsType[self.demo_state[&#x27;selected_physics&#x27;].upper()]
            for x, y in self.emitter_positions:
                # print(f&#x27;X: {x} &gt; {pos_x}, Y: {y} &gt; {pos_y}&#x27;)
                self.particle_system.emit(
                    x=x, y=y,
                    particle_type=particle_type,
                    count=int(self.demo_state[&#x27;emission_rate&#x27;] * dt),
                    exit_point=exit_point,
                    physics_type=physics_type,
                    spread=self.demo_state[&#x27;spread&#x27;]
                )
        
        # Update performance displays
        stats = self.particle_system.get_stats()
        fps_stats = self.engine.get_fps_stats()
        
        self.demo_state[&#x27;active_particles&#x27;] = stats[&#x27;active_particles&#x27;]
        self.demo_state[&#x27;fps&#x27;] = fps_stats[&#x27;current_fps&#x27;]
        self.demo_state[&#x27;memory_usage&#x27;] = stats[&#x27;memory_usage_mb&#x27;]
        
        # Update UI displays
        self.fps_display.set_text(f&quot;FPS: {self.demo_state[&#x27;fps&#x27;]:.1f}&quot;)
        self.particle_count_display.set_text(f&quot;Particles: {self.demo_state[&#x27;active_particles&#x27;]}&quot;)
        self.memory_display.set_text(f&quot;Memory: {self.demo_state[&#x27;memory_usage&#x27;]:.2f} MB&quot;)

    def render(self, renderer):
        &quot;&quot;&quot;Render scene&quot;&quot;&quot;
        # Draw background
        renderer.draw_rect(0, 0, 1024, 768, (20, 20, 30))
        
        # Draw emitter position markers (in world coordinates, so convert to screen)
        for x, y in self.emitter_positions:
            screen_pos = self.camera.world_to_screen((x,y))
            renderer.draw_rect(screen_pos.x-2, screen_pos.y-2, 4, 4, (255, 255, 255))
            renderer.draw_rect(screen_pos.x-1, screen_pos.y-1, 2, 2, (100, 200, 255))
        
        # Draw center marker (world (0,0) is the center)
        center_screen = self.camera.world_to_screen((0, 0))
        renderer.draw_rect(center_screen.x-2, center_screen.y-2, 4, 4, (255, 255, 0))

def main():
    &quot;&quot;&quot;Main function&quot;&quot;&quot;
    # Test
    engine = LunaEngine(&quot;LunaEngine - Particle System Demo&quot;, 1024, 768)
    engine.fps = 144
    
    @engine.on_event(pygame.KEYDOWN)
    def handle_keydown(event):
        if event.key == pygame.K_r:
            print(&quot;Resetting particle system...&quot;)
            engine.scenes[&quot;main&quot;].particle_system.clear()
        elif event.key == pygame.K_SPACE:
            engine.scenes[&quot;main&quot;].emit_manual()
    
    engine.add_scene(&quot;main&quot;, ParticleDemoScene)
    engine.set_scene(&quot;main&quot;)
    engine.run()

if __name__ == &quot;__main__&quot;:
    main()</code></pre>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card shadow-sm sticky-top" style="top: 20px;">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="bi bi-info-circle me-2"></i>About This Example</h5>
                    </div>
                    <div class="card-body">
                        <p>Particle System Demo - Fixed Version</p>
                        <hr>
                        <div class="d-grid gap-2">
                            <a href="particle_demo.py" download class="btn btn-outline-primary">
                                <i class="bi bi-download me-2"></i>Download Python File
                            </a>
                            <a href="index.html" class="btn btn-outline-secondary">
                                <i class="bi bi-arrow-left me-2"></i>Back to Examples Hub
                            </a>
                            <a href="../quick-start.html" class="btn btn-outline-success">
                                <i class="bi bi-play-circle me-2"></i>Quick Start Guide
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="footer-section">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5><i class="bi bi-moon-stars-fill me-2"></i>LunaEngine</h5>
                    <p class="text-white-50">2D Game Framework for Python</p>
                </div>
                <div class="col-md-6 text-end">
                    <p class="text-white-50">
                        <i class="bi bi-lightning-charge me-1"></i>
                        Documentation generated on 2026-02-03 16:03
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="theme.js"></script>
    
    <script>
    // Universal search handler
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('moduleSearch');
        const searchIcon = document.querySelector('.input-group-text');
        
        if (searchInput && searchIcon) {
            const performSearch = () => {
                const searchTerm = searchInput.value.trim();
                if (searchTerm) {
                    const currentPath = window.location.pathname;
                    let searchPath = 'search.html';
                    
                    // Adjust path based on current location
                    if (currentPath.split('/').filter(Boolean).length > 2) {
                        searchPath = '../search.html';
                    }
                    
                    window.location.href = `${searchPath}?q=${encodeURIComponent(searchTerm)}`;
                }
            };
            
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault(); 
                    e.stopPropagation();
                    performSearch();
                    return false;
                }
            });
            
            searchIcon.addEventListener('click', performSearch);
            
            const form = searchInput.closest('form');
            if (form) {
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    performSearch();
                    return false;
                });
            }
        }
    });
    </script>
    
    
</body>
</html>